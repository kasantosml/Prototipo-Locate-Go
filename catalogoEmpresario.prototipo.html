<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerência de Produtos</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --primary:#8c0a0a;
  --bg:#f1f1f1;
  --card:#ffffff;
  --radius:18px;
}

/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Arial, Helvetica, sans-serif;
}

body{
  background:var(--bg);
}

/* HEADER */
header{
  background:linear-gradient(135deg,#b11212,#7d0505);
  color:#fff;
  padding:14px 18px;
  display:flex;
  align-items:center;
  gap:14px;
}

header i{
  font-size:22px;
  cursor:pointer;
  
}

header img{
  width:48px;
  border-radius:50%;
  margin-left: 130px;
}

.header-spacer{
  flex:1;
}

/* MENU */
.menu{
  position:absolute;
  right:18px;
  top:70px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  overflow:hidden;
  transform:scale(0);
  transform-origin:top right;
  transition:.2s;
  z-index:10;
  width: 50%;
}

.menu.active{ transform:scale(1); }

.menu button{
  width:100%;
  padding:15px 15px;
  border:none;
  background:none;
  text-align:left;
  cursor:pointer;
}

.menu button:hover{
  background:var(--primary);
  color:#fff;
}

/* MAIN */
main{
  padding:20px;
  padding-bottom:160px;
}

#contador{
  font-weight:bold;
  margin-bottom:20px;
}

/* PRODUTO CARD */
.produto{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:18px;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
  display:flex;
  flex-direction:column;
  gap:14px;
}

.produto.selected{
  outline:3px solid var(--primary);
}

/* IMAGE CARD */
.image-card{
  width:100%;
  height:160px;
  background:#e0e0e0;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  overflow:hidden;
}

.image-card img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* FORM */
.produto input,
.produto textarea{
  border:none;
  outline:none;
  font-size:16px;
  background:transparent;
  width:100%;
}

textarea{ resize:none; }

/* BOTÕES */
.add-btn{
  position:fixed;
  bottom:150px;
  right:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  border:none;
  background:#000;
  color:#fff;
  font-size:26px;
  cursor:pointer;
}

.save-btn{
  position:fixed;
  bottom:80px;
  right:20px;
  padding:14px 22px;
  border-radius:30px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

/* FOOTER */
footer{
  position:fixed;
  bottom:0;
  width:100%;
  background:#d1d1d1;
  display:flex;
  justify-content:space-between;
}

footer button{
  background:none;
  border:none;
  padding:16px;
  font-size:24px;
  cursor:pointer;
}

#home{ color:var(--primary); }
</style>
</head>

<body>

<header>
  <i class="fa-solid fa-arrow-left" onclick="history.back()"></i>
  <img src="locate.png">
  <div class="header-spacer"></div>
  <i class="fa-solid fa-bars" id="menuBtn"></i>

  <div class="menu" id="menu">
    <button data-action="alfabetica">Ordem Alfabética</button>
    <button data-action="maior-preco">Maior Preço</button>
    <button data-action="menor-preco">Menor Preço</button>
    <button data-action="excluir">Excluir Selecionado</button>
  </div>
</header>

<main>
  <h2>Catálogo de Produtos</h2><br>
  <div id="contador">00 PRODUTOS</div>
  <div id="lista"></div>
</main>

<button class="add-btn" id="add">+</button>
<button class="save-btn" id="save">Salvar</button>

<footer id="footer">
  <a href="perfilEmpresario.montado.prototipo.html">
    <button><i class="fa-solid fa-user"></i></button>
  </a>

  <a href="gerencia.prototipo.html">
    <button><i class="fa-solid fa-house" id="home"></i></button>
  </a>
</footer>

<script>
let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
let selecionado = null;

const lista = document.getElementById('lista');
const contador = document.getElementById('contador');
const addBtn = document.getElementById('add');
const saveBtn = document.getElementById('save');
const menuBtn = document.getElementById('menuBtn');
const menu = document.getElementById('menu');

menuBtn.onclick = () => menu.classList.toggle('active');

function salvar(){
  localStorage.setItem('produtos', JSON.stringify(produtos));
  contador.textContent =
    String(produtos.length).padStart(2,'0') + ' PRODUTOS';
}

/* CONVERTE PREÇO */
function precoNumero(p){
  if(!p) return 0;
  return Number(
    p.replace('R$','')
     .replace(/\./g,'')
     .replace(',','.')
  );
}

function render(){
  lista.innerHTML='';
  selecionado=null;

  produtos.forEach((p,i)=>{
    const card=document.createElement('div');
    card.className='produto';

    card.innerHTML=`
      <div class="image-card">
        ${p.imagem ? `<img src="${p.imagem}">` : `<span>Adicionar foto</span>`}
        <input type="file" hidden>
      </div>
      <input placeholder="Nome do produto" value="${p.nome||''}">
      <textarea placeholder="Descrição">${p.desc||''}</textarea>
      <input placeholder="R$ 0,00" value="${p.preco||''}" class="preco">
    `;

    card.onclick=()=>{
      document.querySelectorAll('.produto')
        .forEach(c=>c.classList.remove('selected'));
      card.classList.add('selected');
      selecionado=i;
    };

    const [img,file,nome,desc,preco]=card.querySelectorAll(
      '.image-card,input[type=file],input:not([type=file]),textarea'
    );

    img.onclick=()=>file.click();

    file.onchange=e=>{
      const reader=new FileReader();
      reader.onload=()=>p.imagem=reader.result;
      reader.readAsDataURL(e.target.files[0]);
    };

    nome.oninput=e=>p.nome=e.target.value;
    desc.oninput=e=>p.desc=e.target.value;
    preco.oninput=e=>p.preco=e.target.value;

    lista.appendChild(card);
  });

  contador.textContent =
    String(produtos.length).padStart(2,'0') + ' PRODUTOS';
}

render();

/* ADD */
addBtn.onclick=()=>{
  produtos.push({nome:'',desc:'',preco:'',imagem:''});
  render();
};

/* SALVAR */
saveBtn.onclick=()=>{
  salvar();
  alert('Alterações salvas com sucesso!');
};

/* MENU */
menu.onclick=e=>{
  if(!e.target.dataset.action) return;

  if(e.target.dataset.action==='alfabetica')
    produtos.sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR'));

  if(e.target.dataset.action==='maior-preco')
    produtos.sort((a,b)=>precoNumero(b.preco)-precoNumero(a.preco));

  if(e.target.dataset.action==='menor-preco')
    produtos.sort((a,b)=>precoNumero(a.preco)-precoNumero(b.preco));

  if(e.target.dataset.action==='excluir' && selecionado!==null)
    produtos.splice(selecionado,1);

  render();
  menu.classList.remove('active');
};

//mascara de preço
function formatarPrecoInput(input){
  input.addEventListener('input', () => {
    let valor = input.value.replace(/\D/g,'');

    if(valor === '') {
      input.value = '';
      return;
    }

    valor = (parseInt(valor,10) / 100).toFixed(2);
    valor = valor.replace('.', ',');
    valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, '.');

    input.value = 'R$ ' + valor;
  });

  input.addEventListener('focus', () => {
    if(input.value === '') input.value = 'R$ 0,00';
  });

  input.addEventListener('blur', () => {
    if(input.value === 'R$ 0,00') input.value = '';
  });
}

/* APLICA EM TODOS OS INPUTS */
function ativarMascaraPreco(){
  document.querySelectorAll('.preco').forEach(input => {
    if(!input.dataset.mask){
      formatarPrecoInput(input);
      input.dataset.mask = 'true';
    }
  });
}

/* ATIVA AO CARREGAR */
ativarMascaraPreco();
</script>

</body>
</html>
